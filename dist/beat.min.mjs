var Tt=Object.create;var lt=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var bt=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty;var Dt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var Et=(n,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Rt(t))!It.call(n,r)&&r!==e&&lt(n,r,{get:()=>t[r],enumerable:!(o=Mt(t,r))||o.enumerable});return n};var Ct=(n,t,e)=>(e=n!=null?Tt(bt(n)):{},Et(t||!n||!n.__esModule?lt(e,"default",{value:n,enumerable:!0}):e,n));var pt=Dt((Bt,ht)=>{"use strict";function w(n){if(this.size=n|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=n<<1;for(var t=new Array(this.size*2),e=0;e<t.length;e+=2){let c=Math.PI*e/this.size;t[e]=Math.cos(c),t[e+1]=-Math.sin(c)}this.table=t;for(var o=0,r=1;this.size>r;r<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var i=0;i<this._width;i+=2){var a=this._width-i-2;this._bitrev[s]|=(s>>>i&3)<<a}}this._out=null,this._data=null,this._inv=0}ht.exports=w;w.prototype.fromComplexArray=function(t,e){for(var o=e||new Array(t.length>>>1),r=0;r<t.length;r+=2)o[r>>>1]=t[r];return o};w.prototype.createComplexArray=function(){let t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t};w.prototype.toComplexArray=function(t,e){for(var o=e||this.createComplexArray(),r=0;r<o.length;r+=2)o[r]=t[r>>>1],o[r+1]=0;return o};w.prototype.completeSpectrum=function(t){for(var e=this._csize,o=e>>>1,r=2;r<o;r+=2)t[e-r]=t[r],t[e-r+1]=-t[r+1]};w.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null};w.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null};w.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var o=0;o<t.length;o++)t[o]/=this.size;this._out=null,this._data=null};w.prototype._transform4=function(){var t=this._out,e=this._csize,o=this._width,r=1<<o,s=e/r<<1,i,a,c=this._bitrev;if(s===4)for(i=0,a=0;i<e;i+=s,a++){let f=c[a];this._singleTransform2(i,f,r)}else for(i=0,a=0;i<e;i+=s,a++){let f=c[a];this._singleTransform4(i,f,r)}var l=this._inv?-1:1,h=this.table;for(r>>=2;r>=2;r>>=2){s=e/r<<1;var u=s>>>2;for(i=0;i<e;i+=s)for(var p=i+u,m=i,v=0;m<p;m+=2,v+=r){let f=m,g=f+u,d=g+u,_=d+u,F=t[f],T=t[f+1],A=t[g],x=t[g+1],M=t[d],R=t[d+1],b=t[_],I=t[_+1],D=F,E=T,C=h[v],V=l*h[v+1],W=A*C-x*V,U=A*V+x*C,G=h[2*v],S=l*h[2*v+1],X=M*G-R*S,$=M*S+R*G,H=h[3*v],J=l*h[3*v+1],K=b*H-I*J,Q=b*J+I*H,Y=D+X,z=E+$,B=D-X,Z=E-$,j=W+K,P=U+Q,N=l*(W-K),k=l*(U-Q),q=Y+j,L=z+P,O=Y-j,tt=z-P,et=B+k,rt=Z-N,nt=B-k,ot=Z+N;t[f]=q,t[f+1]=L,t[g]=et,t[g+1]=rt,t[d]=O,t[d+1]=tt,t[_]=nt,t[_+1]=ot}}};w.prototype._singleTransform2=function(t,e,o){let r=this._out,s=this._data,i=s[e],a=s[e+1],c=s[e+o],l=s[e+o+1],h=i+c,u=a+l,p=i-c,m=a-l;r[t]=h,r[t+1]=u,r[t+2]=p,r[t+3]=m};w.prototype._singleTransform4=function(t,e,o){let r=this._out,s=this._data,i=this._inv?-1:1,a=o*2,c=o*3,l=s[e],h=s[e+1],u=s[e+o],p=s[e+o+1],m=s[e+a],v=s[e+a+1],f=s[e+c],g=s[e+c+1],d=l+m,_=h+v,F=l-m,T=h-v,A=u+f,x=p+g,M=i*(u-f),R=i*(p-g),b=d+A,I=_+x,D=F+R,E=T-M,C=d-A,V=_-x,W=F-R,U=T+M;r[t]=b,r[t+1]=I,r[t+2]=D,r[t+3]=E,r[t+4]=C,r[t+5]=V,r[t+6]=W,r[t+7]=U};w.prototype._realTransform4=function(){var t=this._out,e=this._csize,o=this._width,r=1<<o,s=e/r<<1,i,a,c=this._bitrev;if(s===4)for(i=0,a=0;i<e;i+=s,a++){let st=c[a];this._singleRealTransform2(i,st>>>1,r>>>1)}else for(i=0,a=0;i<e;i+=s,a++){let st=c[a];this._singleRealTransform4(i,st>>>1,r>>>1)}var l=this._inv?-1:1,h=this.table;for(r>>=2;r>=2;r>>=2){s=e/r<<1;var u=s>>>1,p=u>>>1,m=p>>>1;for(i=0;i<e;i+=s)for(var v=0,f=0;v<=m;v+=2,f+=r){var g=i+v,d=g+p,_=d+p,F=_+p,T=t[g],A=t[g+1],x=t[d],M=t[d+1],R=t[_],b=t[_+1],I=t[F],D=t[F+1],E=T,C=A,V=h[f],W=l*h[f+1],U=x*V-M*W,G=x*W+M*V,S=h[2*f],X=l*h[2*f+1],$=R*S-b*X,H=R*X+b*S,J=h[3*f],K=l*h[3*f+1],Q=I*J-D*K,Y=I*K+D*J,z=E+$,B=C+H,Z=E-$,j=C-H,P=U+Q,N=G+Y,k=l*(U-Q),q=l*(G-Y),L=z+P,O=B+N,tt=Z+q,et=j-k;if(t[g]=L,t[g+1]=O,t[d]=tt,t[d+1]=et,v===0){var rt=z-P,nt=B-N;t[_]=rt,t[_+1]=nt;continue}if(v!==m){var ot=Z,mt=-j,vt=z,ft=-B,gt=-l*q,dt=-l*k,yt=-l*N,_t=-l*P,wt=ot+gt,xt=mt+dt,Ft=vt+_t,At=ft-yt,at=i+p-v,it=i+u-v;t[at]=wt,t[at+1]=xt,t[it]=Ft,t[it+1]=At}}}};w.prototype._singleRealTransform2=function(t,e,o){let r=this._out,s=this._data,i=s[e],a=s[e+o],c=i+a,l=i-a;r[t]=c,r[t+1]=0,r[t+2]=l,r[t+3]=0};w.prototype._singleRealTransform4=function(t,e,o){let r=this._out,s=this._data,i=this._inv?-1:1,a=o*2,c=o*3,l=s[e],h=s[e+o],u=s[e+a],p=s[e+c],m=l+u,v=l-u,f=h+p,g=i*(h-p),d=m+f,_=v,F=-g,T=m-f,A=v,x=g;r[t]=d,r[t+1]=0,r[t+2]=_,r[t+3]=F,r[t+4]=T,r[t+5]=0,r[t+6]=A,r[t+7]=x}});var Vt={pcm8:(n,t,e,o,r)=>{let s=new Uint8Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c){let l=s[i++]-128;e[c][a]=l<0?l/128:l/127}},pcm16:(n,t,e,o,r)=>{let s=new Int16Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c){let l=s[i++];e[c][a]=l<0?l/32768:l/32767}},pcm24:(n,t,e,o,r)=>{let s=new Uint8Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c){let l=s[i++],h=s[i++],u=s[i++],p=l+(h<<8)+(u<<16),m=p>8388608?p-16777216:p;e[c][a]=m<0?m/8388608:m/8388607}},pcm32:(n,t,e,o,r)=>{let s=new Int32Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c){let l=s[i++];e[c][a]=l<0?l/2147483648:l/2147483647}},pcm32f:(n,t,e,o,r)=>{let s=new Float32Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c)e[c][a]=s[i++]},pcm64f:(n,t,e,o,r)=>{let s=new Float64Array(n,t),i=0;for(let a=0;a<r;++a)for(let c=0;c<o;++c)e[c][a]=s[i++]}};function Wt(n,t,e){let o="pcm"+t+(e?"f":""),r=n[o];if(!r)throw new TypeError("Unsupported data format: "+o);return r}function ct(n){let t=0,e=0;n.buffer?(t=n.byteOffset,e=n.length,n=n.buffer):(t=0,e=n.byteLength);let o=new DataView(n);function r(){let l=o.getUint8(t);return t++,l}function s(){let l=o.getUint16(t,!0);return t+=2,l}function i(){let l=o.getUint32(t,!0);return t+=4,l}function a(l){let h="";for(let u=0;u<l;++u)h+=String.fromCharCode(r());return h}if(a(4)!=="RIFF")throw new TypeError("Invalid WAV file");if(i(),a(4)!=="WAVE")throw new TypeError("Invalid WAV file");let c;for(;t<e;){let l=a(4),h=i(),u=t+h;switch(l){case"fmt ":let p=s();if(p!==1&&p!==3&&p!==65534)throw new TypeError(`Unsupported format in WAV file: ${p.toString(16)}`);c={format:"lpcm",floatingPoint:p===3,channels:s(),sampleRate:i(),byteRate:i(),blockSize:s(),bitDepth:s()};break;case"data":if(!c)throw new TypeError('Missing "fmt " chunk.');let m=Math.floor(h/c.blockSize),v=c.channels,f=c.sampleRate,g=[];for(let d=0;d<v;++d)g[d]=new Float32Array(m);return Wt(Vt,c.bitDepth,c.floatingPoint)(n,t,g,v,m),{sampleRate:f,channelData:g};break}t=u}}var ut=Ct(pt(),1),y=class{constructor(t){typeof t=="string"&&(t=Buffer.from(t,"base64"));let e=ct(t);this.sampleData=e.channelData.map(o=>Array.prototype.slice.call(o)),this.sampleSize=e.channelData[0].length,this.sampleRate=e.sampleRate,this.duration=e.channelData[0].length/e.sampleRate}};y.prototype.getTime=function(n){return n/this.sampleRate};y.prototype.getEnergy=function(n){return n*n};y.prototype.getMinVolumeWithIndex=function(n,t,e){let o=Number.MAX_SAFE_INTEGER,r=-1;for(let s=t;s<e;s++)o>this.sampleData[n][s]&&(o=this.sampleData[n][s],r=s);return{index:r,volume:o}};y.prototype.getMaxVolumeWithIndex=function(n,t,e){let o=Number.MIN_SAFE_INTEGER,r=-1;for(let s=t;s<e;s++)o<this.sampleData[n][s]&&(o=this.sampleData[n][s],r=s);return{index:r,volume:o}};y.prototype.getRMSVolumeWithIndex=function(n,t,e){let o=0;for(let r=t;r<e;r++)o+=Math.pow(this.sampleData[n][r],2);return{index:Math.floor((t+e)*.5),volume:Math.sqrt(o/this.sampleSize)}};y.prototype.getMinVolume=function(n,t,e){return y.prototype.getMinVolumeWithIndex(n,t,e).volume};y.prototype.getMaxVolume=function(n,t,e){return y.prototype.getMaxVolumeWithIndex(n,t,e).volume};y.prototype.getRMSVolume=function(n,t,e){return y.prototype.getRMSVolumeWithIndex(n,t,e).volume};y.prototype.getFrames=function(n){n||(n=this.sampleRate),n=Math.floor(n);let t=Math.ceil(this.sampleSize/n),e=[];for(let o=0;o<t;o++){let r=o*n,s=Math.min(this.sampleSize,o*n+n);e.push({start:r,end:s})}return e};y.prototype.getPeaksWithVolume=function(n,t,e){e||(e=this.getMaxVolumeWithIndex.bind(this));let o=this.getFrames(t),r=[];for(let s=0;s<o.length;s++){let{start:i,end:a}=o[s];r.push(e(n,i,a))}return r};y.prototype.getPeaks=function(n,t,e){return this.getPeaksWithVolume(n,t,e).map(o=>o.index)};y.prototype.getBeatsWithEnergy=function(n,t,e){t||(t=2048),e||(e=1.5);let o=[],r=new ut.default(t),s=this.sampleData[n],i=0;for(let a=0;a<s.length;a+=t){let c=s.slice(a,a+t);if(c.length<t)break;let l=r.createComplexArray();r.realTransform(l,c);let h=[];for(let p=0;p<l.length;p+=2){let m=l[p],v=l[p+1];h.push(Math.sqrt(m*m))}let u=h.reduce((p,m)=>p+m,0);u>i*e&&o.push({index:a,energy:u}),i=u}return o};y.prototype.getBeats=function(n,t,e){return this.getBeatsWithEnergy(n,t,e).map(o=>o.index)};y.prototype.getTemposWithCount=function(n){let t=[];for(let e=0;e<n.length;e++){let o=Math.min(e+10,n.length);for(let r=e+1;r<o;r++){let s=n[e],i=n[r],a=this.sampleRate*60/(i-s);for(;a<90;)a*=2;for(;a>180;)a/=2;a=Math.round(a);let c=t.find(l=>l.tempo===a);c?c.count+=1:t.push({tempo:a,count:1})}}return t.sort((e,o)=>o.count-e.count)};y.prototype.getTempos=function(n){return this.getTemposWithCount(n).map(t=>t.tempo)};export{y as Beat};
