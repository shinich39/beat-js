var w={pcm8:(t,e,o,n,a)=>{let l=new Uint8Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i){let p=l[s++]-128;o[i][r]=p<0?p/128:p/127}},pcm16:(t,e,o,n,a)=>{let l=new Int16Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i){let p=l[s++];o[i][r]=p<0?p/32768:p/32767}},pcm24:(t,e,o,n,a)=>{let l=new Uint8Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i){let p=l[s++],f=l[s++],m=l[s++],h=p+(f<<8)+(m<<16),c=h>8388608?h-16777216:h;o[i][r]=c<0?c/8388608:c/8388607}},pcm32:(t,e,o,n,a)=>{let l=new Int32Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i){let p=l[s++];o[i][r]=p<0?p/2147483648:p/2147483647}},pcm32f:(t,e,o,n,a)=>{let l=new Float32Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i)o[i][r]=l[s++]},pcm64f:(t,e,o,n,a)=>{let l=new Float64Array(t,e),s=0;for(let r=0;r<a;++r)for(let i=0;i<n;++i)o[i][r]=l[s++]}};function A(t,e,o){let n="pcm"+e+(o?"f":""),a=t[n];if(!a)throw new TypeError("Unsupported data format: "+n);return a}function y(t){let e=0,o=0;t.buffer?(e=t.byteOffset,o=t.length,t=t.buffer):(e=0,o=t.byteLength);let n=new DataView(t);function a(){let p=n.getUint8(e);return e++,p}function l(){let p=n.getUint16(e,!0);return e+=2,p}function s(){let p=n.getUint32(e,!0);return e+=4,p}function r(p){let f="";for(let m=0;m<p;++m)f+=String.fromCharCode(a());return f}if(r(4)!=="RIFF")throw new TypeError("Invalid WAV file");if(s(),r(4)!=="WAVE")throw new TypeError("Invalid WAV file");let i;for(;e<o;){let p=r(4),f=s(),m=e+f;switch(p){case"fmt ":let h=l();if(h!==1&&h!==3&&h!==65534)throw new TypeError(`Unsupported format in WAV file: ${h.toString(16)}`);i={format:"lpcm",floatingPoint:h===3,channels:l(),sampleRate:s(),byteRate:s(),blockSize:l(),bitDepth:l()};break;case"data":if(!i)throw new TypeError('Missing "fmt " chunk.');let c=Math.floor(f/i.blockSize),x=i.channels,M=i.sampleRate,d=[];for(let g=0;g<x;++g)d[g]=new Float32Array(c);return A(w,i.bitDepth,i.floatingPoint)(t,e,d,x,c),{sampleRate:M,channelData:d};break}e=m}}var u=class{constructor(e){typeof e=="string"&&(e=Buffer.from(e,"base64"));let o=y(e);this.sampleData=o.channelData.map(n=>Array.prototype.slice.call(n)),this.sampleSize=o.channelData[0].length,this.sampleRate=o.sampleRate,this.duration=o.channelData[0].length/o.sampleRate}};u.prototype.getTime=function(t){return t/this.sampleRate};u.prototype.getMinVolumeWithIndex=function(t,e,o){let n=Number.MAX_SAFE_INTEGER,a=-1;for(let l=e;l<o;l++)n>this.sampleData[t][l]&&(n=this.sampleData[t][l],a=l);return{index:a,volume:n}};u.prototype.getMaxVolumeWithIndex=function(t,e,o){let n=Number.MIN_SAFE_INTEGER,a=-1;for(let l=e;l<o;l++)n<this.sampleData[t][l]&&(n=this.sampleData[t][l],a=l);return{index:a,volume:n}};u.prototype.getRMSVolumeWithIndex=function(t,e,o){let n=0;for(let a=e;a<o;a++)n+=Math.pow(this.sampleData[t][a],2);return{index:Math.floor((e+o)*.5),volume:Math.sqrt(n/this.sampleSize)}};u.prototype.getMinVolume=function(t,e,o){return u.prototype.getMinVolumeWithIndex(t,e,o).volume};u.prototype.getMaxVolume=function(t,e,o){return u.prototype.getMaxVolumeWithIndex(t,e,o).volume};u.prototype.getRMSVolume=function(t,e,o){return u.prototype.getRMSVolumeWithIndex(t,e,o).volume};u.prototype.getFrames=function(t){t||(t=this.sampleRate),t=Math.floor(t);let e=Math.ceil(this.sampleSize/t),o=[];for(let n=0;n<e;n++){let a=n*t,l=Math.min(this.sampleSize,n*t+t);o.push({start:a,end:l})}return o};u.prototype.getBeats=function(t,e,o){o||(o=this.getMaxVolumeWithIndex.bind(this));let n=this.getFrames(e),a=[];for(let l=0;l<n.length;l++){let{start:s,end:r}=n[l];a.push(o(t,s,r))}return a};u.prototype.getPeaks=u.prototype.getBeats;u.prototype.getTemposWithCount=function(t){let e=[];for(let o=0;o<t.length;o++){let n=Math.min(o+10,t.length);for(let a=o+1;a<n;a++){let l=t[o].index,s=t[a].index,r=this.sampleRate*60/(s-l);for(;r<90;)r*=2;for(;r>180;)r/=2;r=Math.round(r);let i=e.find(p=>p.tempo===r);i?i.count+=1:e.push({tempo:r,count:1})}}return e.sort((o,n)=>n.count-o.count)};u.prototype.getTempos=function(t){return this.getTemposWithCount(t).map(e=>e.tempo)};export{u as Beat};
