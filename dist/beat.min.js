"use strict";var beat=(()=>{var Mt=Object.create;var L=Object.defineProperty;var Rt=Object.getOwnPropertyDescriptor;var bt=Object.getOwnPropertyNames;var It=Object.getPrototypeOf,Dt=Object.prototype.hasOwnProperty;var Ct=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Et=(n,t)=>{for(var e in t)L(n,e,{get:t[e],enumerable:!0})},ct=(n,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of bt(t))!Dt.call(n,r)&&r!==e&&L(n,r,{get:()=>t[r],enumerable:!(o=Rt(t,r))||o.enumerable});return n};var Vt=(n,t,e)=>(e=n!=null?Mt(It(n)):{},ct(t||!n||!n.__esModule?L(e,"default",{value:n,enumerable:!0}):e,n)),Wt=n=>ct(L({},"__esModule",{value:!0}),n);var ut=Ct((Gt,pt)=>{"use strict";function w(n){if(this.size=n|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=n<<1;for(var t=new Array(this.size*2),e=0;e<t.length;e+=2){let c=Math.PI*e/this.size;t[e]=Math.cos(c),t[e+1]=-Math.sin(c)}this.table=t;for(var o=0,r=1;this.size>r;r<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var a=0;a<this._width;a+=2){var i=this._width-a-2;this._bitrev[s]|=(s>>>a&3)<<i}}this._out=null,this._data=null,this._inv=0}pt.exports=w;w.prototype.fromComplexArray=function(t,e){for(var o=e||new Array(t.length>>>1),r=0;r<t.length;r+=2)o[r>>>1]=t[r];return o};w.prototype.createComplexArray=function(){let t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t};w.prototype.toComplexArray=function(t,e){for(var o=e||this.createComplexArray(),r=0;r<o.length;r+=2)o[r]=t[r>>>1],o[r+1]=0;return o};w.prototype.completeSpectrum=function(t){for(var e=this._csize,o=e>>>1,r=2;r<o;r+=2)t[e-r]=t[r],t[e-r+1]=-t[r+1]};w.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null};w.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null};w.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var o=0;o<t.length;o++)t[o]/=this.size;this._out=null,this._data=null};w.prototype._transform4=function(){var t=this._out,e=this._csize,o=this._width,r=1<<o,s=e/r<<1,a,i,c=this._bitrev;if(s===4)for(a=0,i=0;a<e;a+=s,i++){let f=c[i];this._singleTransform2(a,f,r)}else for(a=0,i=0;a<e;a+=s,i++){let f=c[i];this._singleTransform4(a,f,r)}var l=this._inv?-1:1,p=this.table;for(r>>=2;r>=2;r>>=2){s=e/r<<1;var u=s>>>2;for(a=0;a<e;a+=s)for(var m=a+u,g=a,v=0;g<m;g+=2,v+=r){let f=g,h=f+u,y=h+u,_=y+u,F=t[f],T=t[f+1],A=t[h],x=t[h+1],M=t[y],R=t[y+1],b=t[_],I=t[_+1],D=F,C=T,E=p[v],V=l*p[v+1],W=A*E-x*V,U=A*V+x*E,G=p[2*v],j=l*p[2*v+1],H=M*G-R*j,X=M*j+R*G,$=p[3*v],J=l*p[3*v+1],K=b*$-I*J,Q=b*J+I*$,Y=D+H,B=C+X,P=D-H,Z=C-X,k=W+K,z=U+Q,N=l*(W-K),S=l*(U-Q),q=Y+k,O=B+z,tt=Y-k,et=B-z,rt=P+S,nt=Z-N,ot=P-S,st=Z+N;t[f]=q,t[f+1]=O,t[h]=rt,t[h+1]=nt,t[y]=tt,t[y+1]=et,t[_]=ot,t[_+1]=st}}};w.prototype._singleTransform2=function(t,e,o){let r=this._out,s=this._data,a=s[e],i=s[e+1],c=s[e+o],l=s[e+o+1],p=a+c,u=i+l,m=a-c,g=i-l;r[t]=p,r[t+1]=u,r[t+2]=m,r[t+3]=g};w.prototype._singleTransform4=function(t,e,o){let r=this._out,s=this._data,a=this._inv?-1:1,i=o*2,c=o*3,l=s[e],p=s[e+1],u=s[e+o],m=s[e+o+1],g=s[e+i],v=s[e+i+1],f=s[e+c],h=s[e+c+1],y=l+g,_=p+v,F=l-g,T=p-v,A=u+f,x=m+h,M=a*(u-f),R=a*(m-h),b=y+A,I=_+x,D=F+R,C=T-M,E=y-A,V=_-x,W=F-R,U=T+M;r[t]=b,r[t+1]=I,r[t+2]=D,r[t+3]=C,r[t+4]=E,r[t+5]=V,r[t+6]=W,r[t+7]=U};w.prototype._realTransform4=function(){var t=this._out,e=this._csize,o=this._width,r=1<<o,s=e/r<<1,a,i,c=this._bitrev;if(s===4)for(a=0,i=0;a<e;a+=s,i++){let at=c[i];this._singleRealTransform2(a,at>>>1,r>>>1)}else for(a=0,i=0;a<e;a+=s,i++){let at=c[i];this._singleRealTransform4(a,at>>>1,r>>>1)}var l=this._inv?-1:1,p=this.table;for(r>>=2;r>=2;r>>=2){s=e/r<<1;var u=s>>>1,m=u>>>1,g=m>>>1;for(a=0;a<e;a+=s)for(var v=0,f=0;v<=g;v+=2,f+=r){var h=a+v,y=h+m,_=y+m,F=_+m,T=t[h],A=t[h+1],x=t[y],M=t[y+1],R=t[_],b=t[_+1],I=t[F],D=t[F+1],C=T,E=A,V=p[f],W=l*p[f+1],U=x*V-M*W,G=x*W+M*V,j=p[2*f],H=l*p[2*f+1],X=R*j-b*H,$=R*H+b*j,J=p[3*f],K=l*p[3*f+1],Q=I*J-D*K,Y=I*K+D*J,B=C+X,P=E+$,Z=C-X,k=E-$,z=U+Q,N=G+Y,S=l*(U-Q),q=l*(G-Y),O=B+z,tt=P+N,et=Z+q,rt=k-S;if(t[h]=O,t[h+1]=tt,t[y]=et,t[y+1]=rt,v===0){var nt=B-z,ot=P-N;t[_]=nt,t[_+1]=ot;continue}if(v!==g){var st=Z,vt=-k,ft=B,gt=-P,dt=-l*q,yt=-l*S,_t=-l*N,wt=-l*z,xt=st+dt,Ft=vt+yt,At=ft+wt,Tt=gt-_t,it=a+m-v,lt=a+u-v;t[it]=xt,t[it+1]=Ft,t[lt]=At,t[lt+1]=Tt}}}};w.prototype._singleRealTransform2=function(t,e,o){let r=this._out,s=this._data,a=s[e],i=s[e+o],c=a+i,l=a-i;r[t]=c,r[t+1]=0,r[t+2]=l,r[t+3]=0};w.prototype._singleRealTransform4=function(t,e,o){let r=this._out,s=this._data,a=this._inv?-1:1,i=o*2,c=o*3,l=s[e],p=s[e+o],u=s[e+i],m=s[e+c],g=l+u,v=l-u,f=p+m,h=a*(p-m),y=g+f,_=v,F=-h,T=g-f,A=v,x=h;r[t]=y,r[t+1]=0,r[t+2]=_,r[t+3]=F,r[t+4]=T,r[t+5]=0,r[t+6]=A,r[t+7]=x}});var Pt={};Et(Pt,{Beat:()=>d});var Ut={pcm8:(n,t,e,o,r)=>{let s=new Uint8Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c){let l=s[a++]-128;e[c][i]=l<0?l/128:l/127}},pcm16:(n,t,e,o,r)=>{let s=new Int16Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c){let l=s[a++];e[c][i]=l<0?l/32768:l/32767}},pcm24:(n,t,e,o,r)=>{let s=new Uint8Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c){let l=s[a++],p=s[a++],u=s[a++],m=l+(p<<8)+(u<<16),g=m>8388608?m-16777216:m;e[c][i]=g<0?g/8388608:g/8388607}},pcm32:(n,t,e,o,r)=>{let s=new Int32Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c){let l=s[a++];e[c][i]=l<0?l/2147483648:l/2147483647}},pcm32f:(n,t,e,o,r)=>{let s=new Float32Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c)e[c][i]=s[a++]},pcm64f:(n,t,e,o,r)=>{let s=new Float64Array(n,t),a=0;for(let i=0;i<r;++i)for(let c=0;c<o;++c)e[c][i]=s[a++]}};function Bt(n,t,e){let o="pcm"+t+(e?"f":""),r=n[o];if(!r)throw new TypeError("Unsupported data format: "+o);return r}function ht(n){let t=0,e=0;n.buffer?(t=n.byteOffset,e=n.length,n=n.buffer):(t=0,e=n.byteLength);let o=new DataView(n);function r(){let l=o.getUint8(t);return t++,l}function s(){let l=o.getUint16(t,!0);return t+=2,l}function a(){let l=o.getUint32(t,!0);return t+=4,l}function i(l){let p="";for(let u=0;u<l;++u)p+=String.fromCharCode(r());return p}if(i(4)!=="RIFF")throw new TypeError("Invalid WAV file");if(a(),i(4)!=="WAVE")throw new TypeError("Invalid WAV file");let c;for(;t<e;){let l=i(4),p=a(),u=t+p;switch(l){case"fmt ":let m=s();if(m!==1&&m!==3&&m!==65534)throw new TypeError(`Unsupported format in WAV file: ${m.toString(16)}`);c={format:"lpcm",floatingPoint:m===3,channels:s(),sampleRate:a(),byteRate:a(),blockSize:s(),bitDepth:s()};break;case"data":if(!c)throw new TypeError('Missing "fmt " chunk.');let g=Math.floor(p/c.blockSize),v=c.channels,f=c.sampleRate,h=[];for(let y=0;y<v;++y)h[y]=new Float32Array(g);return Bt(Ut,c.bitDepth,c.floatingPoint)(n,t,h,v,g),{sampleRate:f,channelData:h};break}t=u}}var mt=Vt(ut(),1),d=class{constructor(t){typeof t=="string"&&(t=Buffer.from(t,"base64"));let e=ht(t);this.sampleData=e.channelData.map(o=>Array.prototype.slice.call(o)),this.sampleSize=e.channelData[0].length,this.sampleRate=e.sampleRate,this.duration=e.channelData[0].length/e.sampleRate}};d.prototype.getTime=function(n){return n/this.sampleRate};d.prototype.getEnergy=function(n){return n*n};d.prototype.getMinVolumeWithIndex=function(n,t,e){let o=Number.MAX_SAFE_INTEGER,r=-1;for(let s=t;s<e;s++)o>this.sampleData[n][s]&&(o=this.sampleData[n][s],r=s);return{index:r,volume:o}};d.prototype.getMaxVolumeWithIndex=function(n,t,e){let o=Number.MIN_SAFE_INTEGER,r=-1;for(let s=t;s<e;s++)o<this.sampleData[n][s]&&(o=this.sampleData[n][s],r=s);return{index:r,volume:o}};d.prototype.getRMSVolumeWithIndex=function(n,t,e){let o=0;for(let r=t;r<e;r++)o+=Math.pow(this.sampleData[n][r],2);return{index:Math.floor((t+e)*.5),volume:Math.sqrt(o/this.sampleSize)}};d.prototype.getMinVolume=function(n,t,e){return d.prototype.getMinVolumeWithIndex(n,t,e).volume};d.prototype.getMaxVolume=function(n,t,e){return d.prototype.getMaxVolumeWithIndex(n,t,e).volume};d.prototype.getRMSVolume=function(n,t,e){return d.prototype.getRMSVolumeWithIndex(n,t,e).volume};d.prototype.getFrames=function(n){n||(n=this.sampleRate),n=Math.floor(n);let t=Math.ceil(this.sampleSize/n),e=[];for(let o=0;o<t;o++){let r=o*n,s=Math.min(this.sampleSize,o*n+n);e.push({start:r,end:s})}return e};d.prototype.getPeaksWithVolume=function(n,t,e){e||(e=this.getMaxVolumeWithIndex.bind(this));let o=this.getFrames(t),r=[];for(let s=0;s<o.length;s++){let{start:a,end:i}=o[s];r.push(e(n,a,i))}return r};d.prototype.getPeaks=function(n,t,e){return this.getPeaksWithVolume(n,t,e).map(o=>o.index)};d.prototype.getBeatsWithEnergy=function(n,t,e,o,r){t||(t=512),e||(e=1.2),o||(o=40),r||(r=8);let s=[],a=[],i=new mt.default(t),c=this.sampleData[n];for(let l=0;l<c.length;l+=t){let p=c.slice(l,l+t);if(p.length<t)break;let u=i.createComplexArray();i.realTransform(u,p);let m=[];for(let h=0;h<u.length;h+=2)m.push(Math.sqrt(u[h]*u[h]+u[h+1]*u[h+1]));let g=0;for(let h=0;h<o;h++)g+=m[h];s.push(g);let v=0,f=0;for(let h=Math.max(0,s.length-1-r);h<s.length;h++)v+=s[h],f++;v/=f,g>v*e&&a.push({index:l,energy:g})}return a};d.prototype.getBeats=function(n,t,e,o,r){return this.getBeatsWithEnergy(n,t,e,o,r).map(s=>s.index)};d.prototype.getTemposWithCount=function(n){let t=[];for(let e=0;e<n.length;e++){let o=Math.min(e+10,n.length);for(let r=e+1;r<o;r++){let s=n[e],a=n[r],i=this.sampleRate*60/(a-s);for(;i<90;)i*=2;for(;i>180;)i/=2;i=Math.round(i);let c=t.find(l=>l.tempo===i);c?c.count+=1:t.push({tempo:i,count:1})}}return t.sort((e,o)=>o.count-e.count)};d.prototype.getTempos=function(n){return this.getTemposWithCount(n).map(t=>t.tempo)};return Wt(Pt);})();
