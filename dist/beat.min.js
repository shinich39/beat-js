"use strict";var beat=(()=>{var x=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var V=(t,e)=>{for(var o in e)x(t,o,{get:e[o],enumerable:!0})},v=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of R(e))!I.call(t,l)&&l!==o&&x(t,l,{get:()=>e[l],enumerable:!(n=A(e,l))||n.enumerable});return t};var F=t=>v(x({},"__esModule",{value:!0}),t);var E={};V(E,{Beat:()=>u});var W={pcm8:(t,e,o,n,l)=>{let r=new Uint8Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i){let p=r[s++]-128;o[i][a]=p<0?p/128:p/127}},pcm16:(t,e,o,n,l)=>{let r=new Int16Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i){let p=r[s++];o[i][a]=p<0?p/32768:p/32767}},pcm24:(t,e,o,n,l)=>{let r=new Uint8Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i){let p=r[s++],m=r[s++],f=r[s++],h=p+(m<<8)+(f<<16),c=h>8388608?h-16777216:h;o[i][a]=c<0?c/8388608:c/8388607}},pcm32:(t,e,o,n,l)=>{let r=new Int32Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i){let p=r[s++];o[i][a]=p<0?p/2147483648:p/2147483647}},pcm32f:(t,e,o,n,l)=>{let r=new Float32Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i)o[i][a]=r[s++]},pcm64f:(t,e,o,n,l)=>{let r=new Float64Array(t,e),s=0;for(let a=0;a<l;++a)for(let i=0;i<n;++i)o[i][a]=r[s++]}};function D(t,e,o){let n="pcm"+e+(o?"f":""),l=t[n];if(!l)throw new TypeError("Unsupported data format: "+n);return l}function M(t){let e=0,o=0;t.buffer?(e=t.byteOffset,o=t.length,t=t.buffer):(e=0,o=t.byteLength);let n=new DataView(t);function l(){let p=n.getUint8(e);return e++,p}function r(){let p=n.getUint16(e,!0);return e+=2,p}function s(){let p=n.getUint32(e,!0);return e+=4,p}function a(p){let m="";for(let f=0;f<p;++f)m+=String.fromCharCode(l());return m}if(a(4)!=="RIFF")throw new TypeError("Invalid WAV file");if(s(),a(4)!=="WAVE")throw new TypeError("Invalid WAV file");let i;for(;e<o;){let p=a(4),m=s(),f=e+m;switch(p){case"fmt ":let h=r();if(h!==1&&h!==3&&h!==65534)throw new TypeError(`Unsupported format in WAV file: ${h.toString(16)}`);i={format:"lpcm",floatingPoint:h===3,channels:r(),sampleRate:s(),byteRate:s(),blockSize:r(),bitDepth:r()};break;case"data":if(!i)throw new TypeError('Missing "fmt " chunk.');let c=Math.floor(m/i.blockSize),y=i.channels,w=i.sampleRate,g=[];for(let d=0;d<y;++d)g[d]=new Float32Array(c);return D(W,i.bitDepth,i.floatingPoint)(t,e,g,y,c),{sampleRate:w,channelData:g};break}e=f}}var u=class{constructor(e){typeof e=="string"&&(e=Buffer.from(e,"base64"));let o=M(e);this.sampleData=o.channelData.map(n=>Array.prototype.slice.call(n)),this.sampleSize=o.channelData[0].length,this.sampleRate=o.sampleRate,this.duration=o.channelData[0].length/o.sampleRate}};u.prototype.getTime=function(t){return t/this.sampleRate};u.prototype.getMinVolumeWithIndex=function(t,e,o){let n=Number.MAX_SAFE_INTEGER,l=-1;for(let r=e;r<o;r++)n>this.sampleData[t][r]&&(n=this.sampleData[t][r],l=r);return{index:l,volume:n}};u.prototype.getMaxVolumeWithIndex=function(t,e,o){let n=Number.MIN_SAFE_INTEGER,l=-1;for(let r=e;r<o;r++)n<this.sampleData[t][r]&&(n=this.sampleData[t][r],l=r);return{index:l,volume:n}};u.prototype.getRMSVolumeWithIndex=function(t,e,o){let n=0;for(let l=e;l<o;l++)n+=Math.pow(this.sampleData[t][l],2);return{index:Math.floor((e+o)*.5),volume:Math.sqrt(n/this.sampleSize)}};u.prototype.getMinVolume=function(t,e,o){return u.prototype.getMinVolumeWithIndex(t,e,o).volume};u.prototype.getMaxVolume=function(t,e,o){return u.prototype.getMaxVolumeWithIndex(t,e,o).volume};u.prototype.getRMSVolume=function(t,e,o){return u.prototype.getRMSVolumeWithIndex(t,e,o).volume};u.prototype.getFrames=function(t){t||(t=this.sampleRate),t=Math.floor(t);let e=Math.ceil(this.sampleSize/t),o=[];for(let n=0;n<e;n++){let l=n*t,r=Math.min(this.sampleSize,n*t+t);o.push({start:l,end:r})}return o};u.prototype.getBeatsWithVolume=function(t,e,o){o||(o=this.getMaxVolumeWithIndex.bind(this));let n=this.getFrames(e),l=[];for(let r=0;r<n.length;r++){let{start:s,end:a}=n[r];l.push(o(t,s,a))}return l};u.prototype.getBeats=function(t,e,o){return this.getBeatsWithVolume(t,e,o).map(n=>n.index)};u.prototype.getTemposWithCount=function(t){let e=[];for(let o=0;o<t.length;o++){let n=Math.min(o+10,t.length);for(let l=o+1;l<n;l++){let r=t[o],s=t[l],a=this.sampleRate*60/(s-r);for(;a<90;)a*=2;for(;a>180;)a/=2;a=Math.round(a);let i=e.find(p=>p.tempo===a);i?i.count+=1:e.push({tempo:a,count:1})}}return e.sort((o,n)=>n.count-o.count)};u.prototype.getTempos=function(t){return this.getTemposWithCount(t).map(e=>e.tempo)};return F(E);})();
